# Ansible Playbook для установки ClickHouse и Vector

## Содержание
- [Обзор](#обзор)
- [Особенности](#особенности)
- [Требования](#требования)
- [Структура директорий](#структура-директорий)
- [Переменные](#переменные)
- [Использование](#использование)


## Обзор

Этот Ansible playbook автоматически устанавливает и настраивает **ClickHouse** и **Vector** на указанных хостах. Он упрощает процесс развертывания, обеспечивая консистентную и эффективную установку обоих сервисов в вашей инфраструктуре.

- **ClickHouse:** Быстрая открытая система управления колонно-ориентированными базами данных.
- **Vector:** Высокопроизводительный конвейер данных для наблюдаемости.

## Особенности

- **Установка ClickHouse:**
  - Скачивает и устанавливает RPM-пакеты ClickHouse.
  - Создает необходимую базу данных ClickHouse.
  - Управляет сервисом ClickHouse.

- **Установка Vector:**
  - Скачивает и устанавливает RPM-пакеты Vector.
  - Применяет пользовательские конфигурации Vector через шаблоны.
  - Управляет сервисом Vector.

- **Установка Lighthouse:**
  - Устанавливает и настраивает Nginx.
  - Клонирует репозиторий приложения в необходимую директорию.
  - Применяет пользовательские конфигурации Nginx и Lighthouse.
  - Управляет сервисом Lighthouse.

## Требования

- **Ansible:** Версия 2.9 или выше.
- **Управляемые хосты:**
  - Операционная система: Совместима с дистрибутивами на основе RPM (например, CentOS, RHEL, Fedora).
  - Менеджер пакетов: Должен быть доступен yum.
- **Сетевой доступ:**
  - Возможность скачивания пакетов с внешних URL.
  - SSH-доступ к управляемым хостам.

## Структура директорий
  ```
  ans-hw-2-code/
  ├── group_vars/
  │   ├── clickhouse/
  |   |   └── vars.yml 
  |   ├── lighthouse/
  |   |   └── vars.yml         
  │   └── vector
  |       └── vars.yml
  ├── inventory/
  │   └── prod.yml
  ├── templates/
  │   ├── lighthouse.conf.j2
  |   ├── nginx.conf.j2
  │   └── vector.toml.j2
  ├── site.yml
  └── README.md
  ```
- **site.yml:** Основной playbook, содержащий все задачи установки.
- **templates/prod.yml:** Определяет управляемые хосты.
- **group_vars/:** Директория для переменных, специфичных для групп.
- **templates/:** Содержит Jinja2 шаблоны для конфигурационных файлов.

## Переменные

Настройте playbook, задав следующие переменные. Их можно определить в group_vars, host_vars или передать через командную строку.

### Переменные ClickHouse

| Переменная              | Описание                                             | Пример                       |
|-------------------------|------------------------------------------------------|------------------------------|
| clickhouse_version    | Версия ClickHouse для установки.                     | 22.3.3.44                   |
| clickhouse_packages   | Список пакетов ClickHouse для скачивания и установки.| ["clickhouse-client", "clickhouse-server"] |

### Переменные Lighthouse

| Переменная              | Описание                                             | Пример                       |
|-------------------------|------------------------------------------------------|------------------------------|
| lighthouse_git   | Ссылка на репозиторий приложения для клонирования.           | https://github.com/VKCOM/lighthouse.git                   |
| lighthouse_dir   | Дирректория для клонирования приложения. | /etc/nginx/lighthouse |

### Переменные Vector

| Переменная            | Описание                                            | Пример                                                             |
|-----------------------|-----------------------------------------------------|--------------------------------------------------------------------|
| vector_url          | URL для скачивания RPM-пакета Vector.               | https://packages.timber.io/vector/0.22.3/vector-0.22.3-1.x86_64.rpm   |
| vector_version      | Версия Vector для установки.                        | 0.22.3                                                           |


## Использование

1. **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/VN351/ans-hw-3-code.git
    cd ans-hw-3-code
    ```
2. **Настройте инвентарь:**
   Отредактируйте файл templates/prod.yml, добавив ваши хосты ClickHouse, Vector и Lighthouse.
   **Пример templates/prod.yml:**
    ```yml
    ---
    clickhouse:
      hosts:
        clickhouse-01:
          ansible_host: 51.250.0.122
          ansible_user: fedora
    vector:
      hosts:
        vector-01:
          ansible_host: 89.169.131.240
          ansible_user: fedora
    lighthouse:
      hosts:
        lighthouse-01:
          ansible_host: 158.160.52.165
          ansible_user: fedora
    ```
3. **Запустите Playbook:**
    ```bash
    ansible-playbook -i templates/prod.yml site.yml
    ```  


